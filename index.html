<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keynova Lock Pro - قفل بصري آمن محسن</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
--primary: #2563eb;
--primary-dark: #1d4ed8;
--primary-light: #3b82f6;
--secondary: #059669;
--accent: #f59e0b;
--accent-dark: #d97706;
--dark: #0f172a;
--dark-light: #1e293b;
--dark-lighter: #334155;
--light: #f8fafc;
--success: #10b981;
--danger: #ef4444;
--warning: #f59e0b;
--info: #06b6d4;
--gray: #94a3b8;
--gray-dark: #64748b;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Tajawal', Arial, sans-serif;
background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 50%, var(--dark) 100%);
background-attachment: fixed;
color: var(--light);
min-height: 100vh;
padding: 20px;
direction: rtl;
text-align: right;
position: relative;
overflow-x: hidden;
}

body::before {
content: '';
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: 
  radial-gradient(circle at 20% 80%, rgba(37, 99, 235, 0.1) 0%, transparent 50%),
  radial-gradient(circle at 80% 20%, rgba(5, 150, 105, 0.1) 0%, transparent 50%),
  radial-gradient(circle at 40% 40%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
z-index: -1;
}

.container {
max-width: 600px;
margin: 0 auto;
padding: 20px;
position: relative;
z-index: 1;
}

header {
text-align: center;
padding: 30px 0 40px;
position: relative;
}

.logo {
background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--secondary));
width: 100px;
height: 100px;
border-radius: 50%;
margin: 0 auto 20px;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 
  0 10px 30px rgba(37, 99, 235, 0.3),
  0 0 0 4px rgba(37, 99, 235, 0.1),
  inset 0 0 0 2px rgba(255, 255, 255, 0.1);
position: relative;
animation: logoFloat 4s ease-in-out infinite;
}

@keyframes logoFloat {
0%, 100% { transform: translateY(0px) rotate(0deg); }
50% { transform: translateY(-10px) rotate(5deg); }
}

.logo::before {
content: '';
position: absolute;
inset: -10px;
border-radius: 50%;
background: linear-gradient(45deg, transparent, rgba(37, 99, 235, 0.2), transparent);
animation: logoGlow 3s linear infinite;
}

@keyframes logoGlow {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.logo i {
font-size: 42px;
color: white;
z-index: 2;
position: relative;
text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

h1 {
background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
font-size: 32px;
margin-bottom: 8px;
font-weight: 800;
text-shadow: 0 0 30px rgba(37, 99, 235, 0.5);
font-family: 'Amiri', serif;
}

.subtitle {
color: var(--gray);
font-size: 16px;
font-weight: 400;
margin-bottom: 5px;
}

.developer-credit {
color: var(--accent);
font-size: 14px;
font-weight: 500;
opacity: 0.9;
}

.card {
background: linear-gradient(135deg, 
  rgba(30, 41, 59, 0.95) 0%, 
  rgba(51, 65, 85, 0.9) 50%, 
  rgba(30, 41, 59, 0.95) 100%);
backdrop-filter: blur(20px);
border-radius: 20px;
padding: 30px;
margin-bottom: 25px;
box-shadow: 
  0 20px 40px rgba(0, 0, 0, 0.3),
  0 0 0 1px rgba(255, 255, 255, 0.05),
  inset 0 1px 0 rgba(255, 255, 255, 0.1);
transition: all 0.4s ease;
border: 1px solid rgba(255, 255, 255, 0.08);
position: relative;
overflow: hidden;
}

.card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 1px;
background: linear-gradient(90deg, transparent, var(--primary), transparent);
}

.card:hover {
transform: translateY(-5px);
box-shadow: 
  0 30px 60px rgba(0, 0, 0, 0.4),
  0 0 0 1px rgba(37, 99, 235, 0.2),
  inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.card-header {
display: flex;
align-items: center;
margin-bottom: 25px;
padding-bottom: 15px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.card-header i {
font-size: 24px;
margin-left: 12px;
background: linear-gradient(135deg, var(--primary), var(--secondary));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.card-header h3 {
font-size: 22px;
font-weight: 700;
color: var(--light);
text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.form-group {
margin-bottom: 25px;
}

.form-label {
color: var(--primary-light);
margin-bottom: 12px;
display: block;
font-weight: 600;
font-size: 16px;
text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.file-input {
width: 100%;
padding: 16px 20px;
background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
border: 1px solid rgba(255, 255, 255, 0.15);
border-radius: 12px;
color: var(--light);
font-size: 16px;
cursor: pointer;
transition: all 0.3s ease;
backdrop-filter: blur(10px);
box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
}

.file-input:hover {
border-color: var(--primary);
background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.08));
box-shadow: 
  inset 0 1px 3px rgba(0, 0, 0, 0.2),
  0 0 0 2px rgba(37, 99, 235, 0.2);
}

.file-input:focus {
outline: none;
border-color: var(--primary);
box-shadow: 
  inset 0 1px 3px rgba(0, 0, 0, 0.2),
  0 0 0 3px rgba(37, 99, 235, 0.3);
}

.image-gallery {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
gap: 15px;
max-height: 400px;
overflow-y: auto;
padding: 20px;
background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
border-radius: 15px;
border: 1px solid rgba(255, 255, 255, 0.08);
backdrop-filter: blur(10px);
}

.image-gallery::-webkit-scrollbar {
width: 8px;
}

.image-gallery::-webkit-scrollbar-track {
background: rgba(255, 255, 255, 0.05);
border-radius: 4px;
}

.image-gallery::-webkit-scrollbar-thumb {
background: linear-gradient(135deg, var(--primary), var(--secondary));
border-radius: 4px;
}

.image-item {
position: relative;
aspect-ratio: 1;
border-radius: 12px;
overflow: hidden;
cursor: pointer;
transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
border: 2px solid rgba(255, 255, 255, 0.1);
background: var(--dark-lighter);
}

.image-item:hover {
transform: scale(1.08) translateY(-5px);
border-color: var(--primary);
box-shadow: 
  0 15px 30px rgba(37, 99, 235, 0.3),
  0 5px 15px rgba(0, 0, 0, 0.3);
z-index: 10;
}

.image-item.selected {
border-color: var(--accent);
box-shadow: 
  0 0 0 3px rgba(245, 158, 11, 0.3),
  0 15px 30px rgba(245, 158, 11, 0.2),
  inset 0 0 20px rgba(245, 158, 11, 0.1);
transform: scale(1.05);
}

.image-item.selected::after {
content: '✓';
position: absolute;
top: 5px;
left: 5px;
background: var(--accent);
color: white;
border-radius: 50%;
width: 24px;
height: 24px;
display: flex;
align-items: center;
justify-content: center;
font-size: 14px;
font-weight: bold;
z-index: 2;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
}

.image-item canvas {
width: 100%;
height: 100%;
object-fit: cover;
transition: all 0.3s ease;
}

.image-item:hover canvas {
transform: scale(1.1);
}

.image-number {
position: absolute;
bottom: 5px;
right: 5px;
background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
color: white;
border-radius: 50%;
width: 28px;
height: 28px;
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
font-weight: bold;
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.2);
z-index: 2;
}

.btn {
display: block;
width: 100%;
padding: 16px 24px;
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
border: none;
border-radius: 12px;
font-size: 18px;
font-weight: 700;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 15px;
text-align: center;
position: relative;
overflow: hidden;
box-shadow: 
  0 4px 15px rgba(37, 99, 235, 0.3),
  inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
transition: left 0.5s ease;
}

.btn:hover::before {
left: 100%;
}

.btn:hover {
background: linear-gradient(135deg, var(--primary-light), var(--primary));
transform: translateY(-3px);
box-shadow: 
  0 8px 25px rgba(37, 99, 235, 0.4),
  inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.btn:active {
transform: translateY(-1px);
}

.btn-secondary {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.btn-danger {
background: linear-gradient(135deg, var(--danger), #dc2626);
}

.btn-danger:hover {
background: linear-gradient(135deg, #f87171, var(--danger));
box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
}

.btn-success {
background: linear-gradient(135deg, var(--success), var(--secondary));
}

.btn-success:hover {
background: linear-gradient(135deg, #34d399, var(--success));
box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
}

select {
width: 100%;
padding: 16px 20px;
background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
border: 1px solid rgba(255, 255, 255, 0.15);
border-radius: 12px;
color: var(--light);
font-size: 16px;
margin-bottom: 20px;
backdrop-filter: blur(10px);
cursor: pointer;
}

select:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
}

.result {
padding: 20px;
border-radius: 12px;
margin-top: 25px;
text-align: center;
font-size: 16px;
font-weight: 600;
display: none;
backdrop-filter: blur(10px);
border: 1px solid;
}

.success {
background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.1));
color: #34d399;
border-color: rgba(16, 185, 129, 0.3);
display: block;
}

.fail {
background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
color: #f87171;
border-color: rgba(239, 68, 68, 0.3);
display: block;
}

.warning {
background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.1));
color: #fbbf24;
border-color: rgba(245, 158, 11, 0.3);
display: block;
}

.hidden {
display: none;
}

.action-buttons {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin-top: 25px;
}

.action-buttons .btn {
margin: 0;
}

.session-timeout {
background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.05));
border: 1px solid rgba(245, 158, 11, 0.3);
padding: 15px;
border-radius: 12px;
text-align: center;
margin-top: 25px;
font-size: 14px;
color: var(--warning);
backdrop-filter: blur(10px);
}

.instructions {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
border-radius: 15px;
padding: 20px;
margin-top: 30px;
border-right: 4px solid var(--primary);
backdrop-filter: blur(10px);
}

.instructions h4 {
color: var(--primary-light);
margin-bottom: 15px;
font-size: 18px;
}

.instructions ul {
padding-right: 25px;
}

.instructions li {
margin-bottom: 10px;
color: var(--gray);
line-height: 1.6;
}

.tab-content {
display: none;
}

.active-tab {
display: block;
}

.tabs {
display: flex;
justify-content: space-between;
background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
border-radius: 15px;
padding: 8px;
margin-bottom: 25px;
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.1);
}

.tab-btn {
flex: 1;
padding: 15px 20px;
text-align: center;
background: transparent;
color: var(--gray);
border: none;
border-radius: 10px;
cursor: pointer;
font-weight: 600;
font-size: 16px;
transition: all 0.3s ease;
position: relative;
}

.tab-btn:hover {
color: var(--primary-light);
background: rgba(37, 99, 235, 0.1);
}

.tab-btn.active {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
box-shadow: 
  0 4px 15px rgba(37, 99, 235, 0.3),
  inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.status-icon {
margin-left: 10px;
}

.no-key-message {
text-align: center;
padding: 40px 30px;
color: var(--warning);
background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));
border-radius: 15px;
border: 1px solid rgba(245, 158, 11, 0.2);
}

.no-key-message i {
font-size: 64px;
margin-bottom: 20px;
display: block;
}

.access-denied {
text-align: center;
padding: 40px 30px;
color: var(--danger);
font-size: 18px;
background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
border-radius: 15px;
border: 1px solid rgba(239, 68, 68, 0.2);
}

.access-denied i {
font-size: 64px;
margin-bottom: 20px;
display: block;
}

.loading-spinner {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
margin-left: 10px;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

.security-badge {
position: absolute;
top: 20px;
left: 20px;
background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.1));
color: var(--success);
padding: 8px 15px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
border: 1px solid rgba(16, 185, 129, 0.3);
backdrop-filter: blur(10px);
}

.feature-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-top: 20px;
}

.feature-card {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
padding: 20px;
border-radius: 12px;
text-align: center;
border: 1px solid rgba(255, 255, 255, 0.08);
transition: all 0.3s ease;
}

.feature-card:hover {
transform: translateY(-5px);
border-color: var(--primary);
box-shadow: 0 10px 30px rgba(37, 99, 235, 0.2);
}

.feature-card i {
font-size: 32px;
color: var(--primary);
margin-bottom: 10px;
}

.feature-card h5 {
color: var(--light);
margin-bottom: 8px;
font-weight: 600;
}

.feature-card p {
color: var(--gray);
font-size: 14px;
}

@media (max-width: 768px) {
.container {
padding: 15px;
}

.card {
padding: 25px 20px;
}

.action-buttons {
grid-template-columns: 1fr;
gap: 15px;
}

h1 {
font-size: 28px;
}

.card-header h3 {
font-size: 20px;
}

.image-gallery {
grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
gap: 12px;
padding: 15px;
}

.logo {
width: 80px;
height: 80px;
}

.logo i {
font-size: 36px;
}

.tabs {
padding: 6px;
}

.tab-btn {
padding: 12px 15px;
font-size: 14px;
}

.feature-grid {
grid-template-columns: 1fr;
}
}

@media (max-width: 480px) {
body {
padding: 10px;
}

.container {
padding: 10px;
}

.card {
padding: 20px 15px;
margin-bottom: 20px;
}

.logo {
width: 70px;
height: 70px;
}

.logo i {
font-size: 32px;
}

h1 {
font-size: 24px;
}

.subtitle {
font-size: 14px;
}

.image-gallery {
grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
gap: 10px;
padding: 12px;
}

.btn {
padding: 14px 20px;
font-size: 16px;
}

.file-input {
padding: 14px 16px;
font-size: 15px;
}

.tab-btn {
padding: 10px 12px;
font-size: 13px;
}
}
</style>
</head>
<body>
<div class="container">
<div class="security-badge">
<i class="fas fa-shield-alt"></i>
تشفير 256-بت
</div>

<header>
<div class="logo">
<i class="fas fa-lock"></i>
</div>
<h1>Keynova Lock Pro</h1>
<p class="subtitle">قفل بصري آمن محسن بمناظر طبيعية خلابة</p>
<p class="developer-credit">مطور البرنامج م: رأفت عمر</p>
</header>

<div class="tabs">
<button id="verify-tab" class="tab-btn active" onclick="openTab('verify')">
<i class="fas fa-unlock-alt"></i>
فتح القفل
</button>
<button id="settings-tab" class="tab-btn" onclick="openTab('settings')">
<i class="fas fa-cog"></i>
الإعدادات
</button>
</div>

<!-- واجهة التحقق -->
<div id="verify" class="tab-content active-tab">
<div class="card">
<div class="card-header">
<i class="fas fa-unlock-alt"></i>
<h3>فتح القفل باستخدام المنظر الطبيعي وكلمة المرور</h3>
</div>

<div class="form-group">
<label class="form-label">اختر المنظر الطبيعي السري:</label>
<div class="image-gallery" id="verifyGallery">
<!-- سيتم إنشاء المناظر الطبيعية ديناميكياً -->
</div>
</div>

<div class="form-group">
<label class="form-label">كلمة المرور السرية:</label>
<input type="password" class="file-input" id="verifyPassword" placeholder="أدخل كلمة المرور السرية" style="font-size: 16px;">
</div>

<button class="btn" onclick="verifyKey()">
<i class="fas fa-check-circle"></i>
تحقق من المفتاح السري
</button>

<div class="result" id="result"></div>
</div>

<div class="instructions">
<h4><i class="fas fa-info-circle"></i> تعليمات الأمان</h4>
<ul>
<li>اختر نفس المنظر الطبيعي الذي تم تعيينه كمفتاح سري</li>
<li>أدخل كلمة المرور الصحيحة التي تم ربطها بالمنظر</li>
<li>تأكد من دقة اختيار المنظر وكتابة كلمة المرور</li>
<li>النظام يستخدم تشفير SHA-256 للحماية القصوى</li>
<li>المحاولات الخاطئة يتم تسجيلها لضمان الأمان</li>
</ul>
</div>
</div>

<!-- واجهة الإعدادات -->
<div id="settings" class="tab-content">
<!-- رسالة عندما لا يوجد مفتاح -->
<div id="no-key-section" class="no-key-message hidden">
<i class="fas fa-key"></i>
<h3>لا يوجد مفتاح أمان محفوظ</h3>
<p>يرجى فتح القفل أولاً باستخدام مفتاحك الحالي أو إنشاء مفتاح جديد</p>
</div>

<!-- محتوى الإعدادات عندما يكون المفتاح متاحاً -->
<div id="settings-content" class="hidden">
<div class="card">
<div class="card-header">
<i class="fas fa-key"></i>
<h3>إدارة المفتاح السري</h3>
</div>

<div class="form-group">
<label class="form-label">اختر منظر طبيعي كمفتاح سري:</label>
<div class="image-gallery" id="settingsGallery">
<!-- سيتم إنشاء المناظر الطبيعية ديناميكياً -->
</div>
</div>

<div class="form-group">
<label class="form-label">كلمة المرور الجديدة:</label>
<input type="password" class="file-input" id="setKeyPassword" placeholder="أدخل كلمة مرور قوية (8 أحرف على الأقل)" style="font-size: 16px;">
</div>

<button class="btn" onclick="setKey()">
<i class="fas fa-save"></i>
حفظ المفتاح السري الجديد
</button>

<div class="action-buttons">
<button class="btn btn-danger" onclick="removeKey()">
<i class="fas fa-trash-alt"></i>
إزالة المفتاح نهائياً
</button>
<button class="btn btn-secondary" onclick="generateSecurePassword()">
<i class="fas fa-random"></i>
إنشاء كلمة مرور آمنة
</button>
</div>
</div>

<div class="card">
<div class="card-header">
<i class="fas fa-shield-alt"></i>
<h3>حماية الملفات والتطبيقات</h3>
</div>

<div class="feature-grid">
<div class="feature-card">
<i class="fas fa-images"></i>
<h5>حماية الصور</h5>
<p>تأمين مجلد الصور الشخصية</p>
</div>

<div class="feature-card">
<i class="fas fa-file-alt"></i>
<h5>حماية المستندات</h5>
<p>تشفير الملفات المهمة</p>
</div>

<div class="feature-card">
<i class="fas fa-mobile-alt"></i>
<h5>حماية التطبيقات</h5>
<p>قفل التطبيقات الحساسة</p>
</div>

<div class="feature-card">
<i class="fas fa-folder-lock"></i>
<h5>حماية مخصصة</h5>
<p>اختيار مجلدات محددة</p>
</div>
</div>

<select id="protectedTarget">
<option value="">-- اختر نوع الحماية المطلوبة --</option>
<option value="images">🖼️ حماية الصور والذكريات</option>
<option value="docs">📄 حماية المستندات المهمة</option>
<option value="apps">📱 حماية التطبيقات الشخصية</option>
<option value="custom">🔒 حماية مجلد مخصص</option>
<option value="system">⚙️ حماية إعدادات النظام</option>
</select>

<div class="action-buttons">
<button class="btn btn-success" onclick="protectSelected()">
<i class="fas fa-lock"></i>
تفعيل الحماية المتقدمة
</button>
<button class="btn btn-secondary" onclick="clearProtection()">
<i class="fas fa-unlock"></i>
إلغاء الحماية مؤقتاً
</button>
</div>

<div class="result" id="protectionStatus"></div>
</div>

<div class="card">
<div class="card-header">
<i class="fas fa-chart-line"></i>
<h3>إحصائيات الأمان</h3>
</div>

<div class="feature-grid">
<div class="feature-card">
<i class="fas fa-check-circle" style="color: var(--success);"></i>
<h5 id="successCount">0</h5>
<p>محاولة نجح</p>
</div>

<div class="feature-card">
<i class="fas fa-times-circle" style="color: var(--danger);"></i>
<h5 id="failCount">0</h5>
<p>محاولة فاشلة</p>
</div>

<div class="feature-card">
<i class="fas fa-clock" style="color: var(--info);"></i>
<h5 id="lastAccess">---</h5>
<p>آخر دخول</p>
</div>

<div class="feature-card">
<i class="fas fa-calendar" style="color: var(--warning);"></i>
<h5 id="creationDate">---</h5>
<p>تاريخ الإنشاء</p>
</div>
</div>
</div>
</div>
</div>

<!-- قسم الإجراءات بعد التحقق -->
<div id="securedActions" class="hidden">
<div class="session-timeout">
<i class="fas fa-clock"></i>
الجلسة الآمنة ستنتهي خلال <span id="sessionTimer">15:00</span>
<div style="margin-top: 10px;">
<div style="background: rgba(255, 255, 255, 0.1); height: 4px; border-radius: 2px; overflow: hidden;">
<div id="sessionProgress" style="background: linear-gradient(90deg, var(--success), var(--warning)); height: 100%; width: 100%; border-radius: 2px; transition: width 1s ease;"></div>
</div>
</div>
</div>

<div class="action-buttons">
<button class="btn" onclick="openTab('settings')">
<i class="fas fa-cog"></i>
الإعدادات المتقدمة
</button>
<button class="btn btn-secondary" onclick="lockSession()">
<i class="fas fa-lock"></i>
قفل الجلسة فوراً
</button>
</div>
</div>
</div>

<script>
let selectedVerifyImage = null;
let selectedSettingsImage = null;
let sessionTimer = null;
let sessionTimeLeft = 900; // 15 دقيقة

// إحصائيات الأمان
let securityStats = {
  successCount: 0,
  failCount: 0,
  lastAccess: null,
  creationDate: null
};

// تحميل الإحصائيات
function loadSecurityStats() {
  const saved = localStorage.getItem('keynova_security_stats');
  if (saved) {
    securityStats = JSON.parse(saved);
    updateStatsDisplay();
  }
}

// حفظ الإحصائيات
function saveSecurityStats() {
  localStorage.setItem('keynova_security_stats', JSON.stringify(securityStats));
  updateStatsDisplay();
}

// تحديث عرض الإحصائيات
function updateStatsDisplay() {
  document.getElementById('successCount').textContent = securityStats.successCount;
  document.getElementById('failCount').textContent = securityStats.failCount;
  document.getElementById('lastAccess').textContent = securityStats.lastAccess ? 
    new Date(securityStats.lastAccess).toLocaleDateString('ar-EG') : '---';
  document.getElementById('creationDate').textContent = securityStats.creationDate ? 
    new Date(securityStats.creationDate).toLocaleDateString('ar-EG') : '---';
}

// إنشاء المناظر الطبيعية الخلابة
function createNaturalLandscape(canvas, sceneType, seed) {
  const ctx = canvas.getContext('2d');
  canvas.width = 120;
  canvas.height = 120;
  
  // مسح الخلفية
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // إعداد البذرة للعشوائية المتسقة
  const random = (function(seed) {
    let x = Math.sin(seed) * 10000;
    return function() {
      x = Math.sin(x) * 10000;
      return x - Math.floor(x);
    };
  })(seed);
  
  switch (sceneType) {
    case 'mountain':
      createMountainScene(ctx, canvas, random);
      break;
    case 'forest':
      createForestScene(ctx, canvas, random);
      break;
    case 'ocean':
      createOceanScene(ctx, canvas, random);
      break;
    case 'desert':
      createDesertScene(ctx, canvas, random);
      break;
    case 'sunset':
      createSunsetScene(ctx, canvas, random);
      break;
    case 'lake':
      createLakeScene(ctx, canvas, random);
      break;
    case 'aurora':
      createAuroraScene(ctx, canvas, random);
      break;
    case 'waterfall':
      createWaterfallScene(ctx, canvas, random);
      break;
    case 'flower':
      createFlowerFieldScene(ctx, canvas, random);
      break;
    case 'winter':
      createWinterScene(ctx, canvas, random);
      break;
    default:
      createMountainScene(ctx, canvas, random);
  }
}

// منظر جبلي
function createMountainScene(ctx, canvas, random) {
  // السماء المتدرجة
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, `hsl(${200 + random() * 40}, 70%, 85%)`);
  skyGradient.addColorStop(0.7, `hsl(${220 + random() * 30}, 60%, 75%)`);
  skyGradient.addColorStop(1, `hsl(${240 + random() * 20}, 50%, 65%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // الغيوم
  ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
  for (let i = 0; i < 4; i++) {
    const x = random() * canvas.width;
    const y = random() * canvas.height * 0.3;
    drawCloud(ctx, x, y, 15 + random() * 10);
  }
  
  // الجبال الخلفية
  ctx.fillStyle = `hsl(${240 + random() * 30}, 30%, 60%)`;
  drawMountain(ctx, 0, canvas.height * 0.4, canvas.width, random);
  
  // الجبال الأمامية
  ctx.fillStyle = `hsl(${120 + random() * 60}, 40%, 35%)`;
  drawMountain(ctx, 0, canvas.height * 0.6, canvas.width, random);
  
  // الأشجار
  for (let i = 0; i < 6; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * 0.7 + random() * 20;
    drawTree(ctx, x, y, `hsl(${100 + random() * 40}, 50%, 25%)`);
  }
}

// منظر غابة
function createForestScene(ctx, canvas, random) {
  // السماء
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, `hsl(${180 + random() * 40}, 50%, 80%)`);
  skyGradient.addColorStop(1, `hsl(${120 + random() * 40}, 60%, 70%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // أشجار الخلفية
  for (let i = 0; i < 12; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.3 + random() * 0.4);
    const hue = 100 + random() * 80;
    drawTree(ctx, x, y, `hsl(${hue}, 60%, ${20 + random() * 20}%)`, 1.5 + random());
  }
  
  // الأرضية
  ctx.fillStyle = `hsl(${80 + random() * 40}, 40%, 30%)`;
  ctx.fillRect(0, canvas.height * 0.8, canvas.width, canvas.height * 0.2);
  
  // أشجار الواجهة
  for (let i = 0; i < 8; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.5 + random() * 0.3);
    drawTree(ctx, x, y, `hsl(${90 + random() * 50}, 70%, 15%)`, 2 + random());
  }
}

// منظر محيط
function createOceanScene(ctx, canvas, random) {
  // السماء
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.6);
  skyGradient.addColorStop(0, `hsl(${200 + random() * 40}, 80%, 90%)`);
  skyGradient.addColorStop(1, `hsl(${220 + random() * 30}, 70%, 80%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height * 0.6);
  
  // المحيط
  const oceanGradient = ctx.createLinearGradient(0, canvas.height * 0.6, 0, canvas.height);
  oceanGradient.addColorStop(0, `hsl(${200 + random() * 40}, 80%, 60%)`);
  oceanGradient.addColorStop(1, `hsl(${210 + random() * 30}, 90%, 40%)`);
  ctx.fillStyle = oceanGradient;
  ctx.fillRect(0, canvas.height * 0.6, canvas.width, canvas.height * 0.4);
  
  // الأمواج
  ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
  ctx.lineWidth = 2;
  for (let i = 0; i < 4; i++) {
    const y = canvas.height * 0.6 + i * 10 + random() * 5;
    drawWave(ctx, y, canvas.width, random);
  }
  
  // الشمس
  const sunX = canvas.width * (0.7 + random() * 0.2);
  const sunY = canvas.height * (0.2 + random() * 0.2);
  drawSun(ctx, sunX, sunY, 15 + random() * 5);
}

// منظر صحراوي
function createDesertScene(ctx, canvas, random) {
  // السماء
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, `hsl(${30 + random() * 40}, 70%, 85%)`);
  skyGradient.addColorStop(1, `hsl(${40 + random() * 30}, 80%, 75%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // الكثبان الرملية
  for (let i = 0; i < 3; i++) {
    const y = canvas.height * (0.4 + i * 0.2);
    ctx.fillStyle = `hsl(${35 + random() * 25}, 60%, ${65 - i * 10}%)`;
    drawDune(ctx, y, canvas.width, random);
  }
  
  // الشمس
  drawSun(ctx, canvas.width * 0.8, canvas.height * 0.2, 20);
  
  // الصبار
  for (let i = 0; i < 3; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.6 + random() * 0.2);
    drawCactus(ctx, x, y, random);
  }
}

// منظر غروب
function createSunsetScene(ctx, canvas, random) {
  // السماء المتدرجة
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, `hsl(${250 + random() * 30}, 60%, 30%)`);
  skyGradient.addColorStop(0.3, `hsl(${300 + random() * 40}, 70%, 50%)`);
  skyGradient.addColorStop(0.7, `hsl(${20 + random() * 40}, 80%, 60%)`);
  skyGradient.addColorStop(1, `hsl(${40 + random() * 30}, 90%, 70%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // الشمس الكبيرة
  const sunGradient = ctx.createRadialGradient(
    canvas.width * 0.7, canvas.height * 0.7, 0,
    canvas.width * 0.7, canvas.height * 0.7, 25
  );
  sunGradient.addColorStop(0, '#FFF8DC');
  sunGradient.addColorStop(0.5, '#FFD700');
  sunGradient.addColorStop(1, '#FF8C00');
  ctx.fillStyle = sunGradient;
  ctx.beginPath();
  ctx.arc(canvas.width * 0.7, canvas.height * 0.7, 25, 0, Math.PI * 2);
  ctx.fill();
  
  // الأرضية الداكنة
  ctx.fillStyle = `hsl(${60 + random() * 40}, 30%, 20%)`;
  ctx.fillRect(0, canvas.height * 0.8, canvas.width, canvas.height * 0.2);
  
  // ظلال الأشجار
  for (let i = 0; i < 5; i++) {
    const x = random() * canvas.width;
    drawTreeSilhouette(ctx, x, canvas.height * 0.8);
  }
}

// منظر بحيرة
function createLakeScene(ctx, canvas, random) {
  // السماء
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.5);
  skyGradient.addColorStop(0, `hsl(${200 + random() * 40}, 70%, 85%)`);
  skyGradient.addColorStop(1, `hsl(${220 + random() * 30}, 60%, 75%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height * 0.5);
  
  // البحيرة
  const lakeGradient = ctx.createLinearGradient(0, canvas.height * 0.5, 0, canvas.height);
  lakeGradient.addColorStop(0, `hsl(${210 + random() * 30}, 80%, 70%)`);
  lakeGradient.addColorStop(1, `hsl(${200 + random() * 40}, 90%, 50%)`);
  ctx.fillStyle = lakeGradient;
  ctx.fillRect(0, canvas.height * 0.5, canvas.width, canvas.height * 0.5);
  
  // انعكاس في الماء
  ctx.save();
  ctx.scale(1, -1);
  ctx.translate(0, -canvas.height);
  ctx.globalAlpha = 0.3;
  
  // أشجار منعكسة
  for (let i = 0; i < 6; i++) {
    const x = random() * canvas.width;
    drawTree(ctx, x, canvas.height * 0.5, `hsl(${100 + random() * 40}, 50%, 25%)`);
  }
  
  ctx.restore();
  
  // أشجار الواجهة
  for (let i = 0; i < 6; i++) {
    const x = random() * canvas.width;
    drawTree(ctx, x, canvas.height * 0.5, `hsl(${100 + random() * 40}, 50%, 25%)`);
  }
}

// منظر الشفق القطبي
function createAuroraScene(ctx, canvas, random) {
  // السماء الليلية
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, '#001122');
  skyGradient.addColorStop(1, '#003344');
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // النجوم
  ctx.fillStyle = 'white';
  for (let i = 0; i < 20; i++) {
    const x = random() * canvas.width;
    const y = random() * canvas.height * 0.6;
    const size = random() * 2;
    ctx.beginPath();
    ctx.arc(x, y, size, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // الشفق القطبي
  ctx.globalCompositeOperation = 'screen';
  const auroraGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height * 0.6);
  auroraGradient.addColorStop(0, `hsla(${120 + random() * 60}, 80%, 60%, 0.6)`);
  auroraGradient.addColorStop(0.5, `hsla(${180 + random() * 60}, 70%, 70%, 0.4)`);
  auroraGradient.addColorStop(1, `hsla(${240 + random() * 60}, 90%, 80%, 0.3)`);
  
  ctx.fillStyle = auroraGradient;
  for (let i = 0; i < 3; i++) {
    const y = canvas.height * (0.1 + i * 0.15);
    drawAuroraWave(ctx, y, canvas.width, random, i);
  }
  
  ctx.globalCompositeOperation = 'source-over';
  
  // الأرضية المثلجة
  ctx.fillStyle = '#E6F3FF';
  ctx.fillRect(0, canvas.height * 0.8, canvas.width, canvas.height * 0.2);
}

// منظر شلال
function createWaterfallScene(ctx, canvas, random) {
  // السماء
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, `hsl(${200 + random() * 40}, 60%, 80%)`);
  skyGradient.addColorStop(1, `hsl(${180 + random() * 40}, 70%, 70%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // الصخور
  ctx.fillStyle = `hsl(${30 + random() * 30}, 30%, 40%)`;
  drawRocks(ctx, canvas, random);
  
  // الشلال
  const waterfallGradient = ctx.createLinearGradient(canvas.width * 0.4, 0, canvas.width * 0.6, canvas.height);
  waterfallGradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
  waterfallGradient.addColorStop(1, 'rgba(173, 216, 230, 0.7)');
  ctx.fillStyle = waterfallGradient;
  ctx.fillRect(canvas.width * 0.45, canvas.height * 0.2, canvas.width * 0.1, canvas.height * 0.6);
  
  // رش الماء
  ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
  for (let i = 0; i < 15; i++) {
    const x = canvas.width * 0.4 + random() * canvas.width * 0.2;
    const y = canvas.height * 0.6 + random() * canvas.height * 0.2;
    ctx.beginPath();
    ctx.arc(x, y, random() * 3, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // النباتات
  for (let i = 0; i < 8; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.7 + random() * 0.2);
    if (x < canvas.width * 0.4 || x > canvas.width * 0.6) {
      drawPlant(ctx, x, y, random);
    }
  }
}

// حقل زهور
function createFlowerFieldScene(ctx, canvas, random) {
  // السماء
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.4);
  skyGradient.addColorStop(0, `hsl(${200 + random() * 40}, 70%, 90%)`);
  skyGradient.addColorStop(1, `hsl(${220 + random() * 30}, 60%, 80%)`);
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height * 0.4);
  
  // الحقل
  const fieldGradient = ctx.createLinearGradient(0, canvas.height * 0.4, 0, canvas.height);
  fieldGradient.addColorStop(0, `hsl(${90 + random() * 40}, 60%, 70%)`);
  fieldGradient.addColorStop(1, `hsl(${110 + random() * 30}, 70%, 50%)`);
  ctx.fillStyle = fieldGradient;
  ctx.fillRect(0, canvas.height * 0.4, canvas.width, canvas.height * 0.6);
  
  // الزهور
  const flowerColors = [
    `hsl(${300 + random() * 60}, 80%, 70%)`, // بنفسجي/وردي
    `hsl(${40 + random() * 40}, 90%, 70%)`,  // أصفر/برتقالي  
    `hsl(${0 + random() * 40}, 80%, 70%)`,   // أحمر
    `hsl(${200 + random() * 60}, 80%, 70%)`, // أزرق
    `hsl(${120 + random() * 40}, 80%, 70%)`  // أخضر
  ];
  
  for (let i = 0; i < 25; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.5 + random() * 0.4);
    const color = flowerColors[Math.floor(random() * flowerColors.length)];
    drawFlower(ctx, x, y, color, random);
  }
}

// منظر شتوي
function createWinterScene(ctx, canvas, random) {
  // السماء الرمادية
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, '#D3D3D3');
  skyGradient.addColorStop(1, '#A0A0A0');
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // الأرضية المثلجة
  ctx.fillStyle = '#F0F8FF';
  ctx.fillRect(0, canvas.height * 0.7, canvas.width, canvas.height * 0.3);
  
  // الأشجار المثلجة
  for (let i = 0; i < 8; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.5 + random() * 0.2);
    drawSnowTree(ctx, x, y, random);
  }
  
  // رقاقات الثلج
  ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
  for (let i = 0; i < 30; i++) {
    const x = random() * canvas.width;
    const y = random() * canvas.height;
    drawSnowflake(ctx, x, y, random() * 3 + 1);
  }
}

// دوال رسم العناصر المساعدة

function drawCloud(ctx, x, y, size) {
  ctx.beginPath();
  ctx.arc(x, y, size, 0, Math.PI * 2);
  ctx.arc(x + size * 0.7, y, size * 0.8, 0, Math.PI * 2);
  ctx.arc(x + size * 1.4, y, size * 0.6, 0, Math.PI * 2);
  ctx.arc(x + size * 0.7, y - size * 0.5, size * 0.7, 0, Math.PI * 2);
  ctx.fill();
}

function drawMountain(ctx, startX, startY, width, random) {
  ctx.beginPath();
  ctx.moveTo(startX, startY + (random() - 0.5) * 20);
  
  for (let x = 0; x <= width; x += 10) {
    const y = startY + (random() - 0.5) * 30 - Math.abs(x - width/2) * 0.3;
    ctx.lineTo(startX + x, y);
  }
  
  ctx.lineTo(startX + width, 120);
  ctx.lineTo(startX, 120);
  ctx.closePath();
  ctx.fill();
}

function drawTree(ctx, x, y, color, scale = 1) {
  // الجذع
  ctx.fillStyle = '#4A4A4A';
  ctx.fillRect(x - 2 * scale, y, 4 * scale, 15 * scale);
  
  // الأوراق
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.arc(x, y - 5 * scale, 8 * scale, 0, Math.PI * 2);
  ctx.fill();
}

function drawTreeSilhouette(ctx, x, y) {
  ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
  ctx.fillRect(x - 2, y, 4, 15);
  ctx.beginPath();
  ctx.arc(x, y - 5, 12, 0, Math.PI * 2);
  ctx.fill();
}

function drawSun(ctx, x, y, radius) {
  const sunGradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
  sunGradient.addColorStop(0, '#FFF8DC');
  sunGradient.addColorStop(0.7, '#FFD700');
  sunGradient.addColorStop(1, '#FFA500');
  
  ctx.fillStyle = sunGradient;
  ctx.beginPath();
  ctx.arc(x, y, radius, 0, Math.PI * 2);
  ctx.fill();
}

function drawWave(ctx, y, width, random) {
  ctx.beginPath();
  ctx.moveTo(0, y);
  
  for (let x = 0; x <= width; x += 10) {
    const waveY = y + Math.sin(x * 0.1 + random() * 10) * 3;
    ctx.lineTo(x, waveY);
  }
  
  ctx.stroke();
}

function drawDune(ctx, y, width, random) {
  ctx.beginPath();
  ctx.moveTo(0, y + random() * 20);
  
  for (let x = 0; x <= width; x += 15) {
    const duneY = y + Math.sin(x * 0.05) * 20 + random() * 10;
    ctx.lineTo(x, duneY);
  }
  
  ctx.lineTo(width, 120);
  ctx.lineTo(0, 120);
  ctx.closePath();
  ctx.fill();
}

function drawCactus(ctx, x, y, random) {
  const height = 20 + random() * 15;
  
  // الجسم الرئيسي
  ctx.fillStyle = `hsl(${90 + random() * 40}, 60%, 40%)`;
  ctx.fillRect(x - 3, y - height, 6, height);
  
  // الأذرع
  if (random() > 0.5) {
    ctx.fillRect(x - 8, y - height * 0.7, 5, height * 0.4);
  }
  if (random() > 0.7) {
    ctx.fillRect(x + 3, y - height * 0.5, 5, height * 0.3);
  }
}

function drawAuroraWave(ctx, y, width, random, layer) {
  const amplitude = 15 + layer * 5;
  const frequency = 0.02 + random() * 0.01;
  
  ctx.beginPath();
  ctx.moveTo(0, y);
  
  for (let x = 0; x <= width; x += 5) {
    const waveY = y + Math.sin(x * frequency + layer) * amplitude;
    ctx.lineTo(x, waveY);
  }
  
  ctx.lineTo(width, y + amplitude * 2);
  ctx.lineTo(0, y + amplitude * 2);
  ctx.closePath();
  ctx.fill();
}

function drawRocks(ctx, canvas, random) {
  for (let i = 0; i < 5; i++) {
    const x = random() * canvas.width;
    const y = canvas.height * (0.6 + random() * 0.2);
    const width = 15 + random() * 20;
    const height = 10 + random() * 15;
    
    ctx.beginPath();
    ctx.ellipse(x, y, width, height, random() * Math.PI, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawPlant(ctx, x, y, random) {
  ctx.strokeStyle = `hsl(${90 + random() * 40}, 70%, 30%)`;
  ctx.lineWidth = 2;
  
  for (let i = 0; i < 3 + random() * 3; i++) {
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.quadraticCurveTo(
      x + (random() - 0.5) * 20,
      y - random() * 15,
      x + (random() - 0.5) * 15,
      y - 10 - random() * 10
    );
    ctx.stroke();
  }
}

function drawFlower(ctx, x, y, color, random) {
  // الساق
  ctx.strokeStyle = `hsl(${90 + random() * 40}, 70%, 30%)`;
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(x, y - 8 - random() * 5);
  ctx.stroke();
  
  // البتلات
  ctx.fillStyle = color;
  for (let i = 0; i < 5; i++) {
    const angle = (i / 5) * Math.PI * 2;
    const petalX = x + Math.cos(angle) * 3;
    const petalY = y - 10 + Math.sin(angle) * 3;
    
    ctx.beginPath();
    ctx.arc(petalX, petalY, 2 + random() * 2, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // المركز
  ctx.fillStyle = `hsl(${40 + random() * 40}, 80%, 70%)`;
  ctx.beginPath();
  ctx.arc(x, y - 10, 1.5, 0, Math.PI * 2);
  ctx.fill();
}

function drawSnowTree(ctx, x, y, random) {
  // الجذع
  ctx.fillStyle = '#4A4A4A';
  ctx.fillRect(x - 2, y, 4, 15);
  
  // الأوراق المثلجة
  ctx.fillStyle = '#228B22';
  ctx.beginPath();
  ctx.arc(x, y - 5, 8, 0, Math.PI * 2);
  ctx.fill();
  
  // الثلج على الشجرة
  ctx.fillStyle = '#F0F8FF';
  ctx.beginPath();
  ctx.arc(x, y - 5, 6, 0, Math.PI);
  ctx.fill();
}

function drawSnowflake(ctx, x, y, size) {
  ctx.beginPath();
  ctx.arc(x, y, size, 0, Math.PI * 2);
  ctx.fill();
}

// إنشاء معرض المناظر الطبيعية
function createImageGallery(containerId, isSettings = false) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  
  const sceneTypes = [
    'mountain', 'forest', 'ocean', 'desert', 'sunset',
    'lake', 'aurora', 'waterfall', 'flower', 'winter',
    'mountain', 'forest', 'ocean', 'desert', 'sunset',
    'lake', 'aurora', 'waterfall', 'flower', 'winter'
  ];
  
  for (let i = 1; i <= 20; i++) {
    const imageItem = document.createElement('div');
    imageItem.className = 'image-item';
    imageItem.onclick = () => selectImage(i, isSettings);
    
    const canvas = document.createElement('canvas');
    const sceneType = sceneTypes[(i - 1) % sceneTypes.length];
    createNaturalLandscape(canvas, sceneType, i * 123 + (isSettings ? 456 : 789));
    
    const numberDiv = document.createElement('div');
    numberDiv.className = 'image-number';
    numberDiv.textContent = i;
    
    imageItem.appendChild(canvas);
    imageItem.appendChild(numberDiv);
    imageItem.dataset.imageId = i;
    
    container.appendChild(imageItem);
  }
}

// اختيار صورة
function selectImage(imageId, isSettings = false) {
  const galleryId = isSettings ? 'settingsGallery' : 'verifyGallery';
  const container = document.getElementById(galleryId);
  
  // إزالة التحديد السابق
  container.querySelectorAll('.image-item').forEach(item => {
    item.classList.remove('selected');
  });
  
  // تحديد الصورة الجديدة
  const selectedItem = container.querySelector(`[data-image-id="${imageId}"]`);
  if (selectedItem) {
    selectedItem.classList.add('selected');
    
    if (isSettings) {
      selectedSettingsImage = imageId;
    } else {
      selectedVerifyImage = imageId;
    }
  }
}

// دالة لحساب بصمة مركبة من الصورة وكلمة المرور
async function calculateCombinedHash(imageId, password) {
  try {
    const combinedData = `nature_scene_${imageId}_secure_password_${password}_keynova_v2`;
    const encoder = new TextEncoder();
    const data = encoder.encode(combinedData);
    
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  } catch (error) {
    console.error("Error calculating hash:", error);
    showResult("حدث خطأ أثناء معالجة البيانات الآمنة", "fail");
    return null;
  }
}

// دالة التحقق من المفتاح
async function verifyKey() {
  if (!selectedVerifyImage) {
    showResult("يرجى اختيار منظر طبيعي للتحقق منه", "fail");
    return;
  }

  const password = document.getElementById("verifyPassword").value;
  if (!password) {
    showResult("يرجى إدخال كلمة المرور السرية", "fail");
    return;
  }

  const storedHash = localStorage.getItem("keynova_combined_hash_v2");

  if (!storedHash) {
    showResult("لا يوجد مفتاح آمان محفوظ، يرجى إنشاء مفتاح جديد أولاً", "warning");
    document.getElementById("settings-content").classList.remove("hidden");
    document.getElementById("no-key-section").classList.add("hidden");
    return;
  }

  showResult("جاري التحقق من المفتاح الآمن..." + '<div class="loading-spinner"></div>', "warning");

  try {
    // تأخير للمحاكاة
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    const currentHash = await calculateCombinedHash(selectedVerifyImage, password);
    if (!currentHash) return;

    if (currentHash === storedHash) {
      securityStats.successCount++;
      securityStats.lastAccess = new Date().toISOString();
      saveSecurityStats();
      
      showResult("✅ تم التحقق بنجاح! مرحباً بك في النظام الآمن", "success");
      document.getElementById("securedActions").classList.remove("hidden");
      document.getElementById("settings-content").classList.remove("hidden");
      document.getElementById("no-key-section").classList.add("hidden");
      startSessionTimer();
    } else {
      securityStats.failCount++;
      saveSecurityStats();
      
      showResult("❌ المنظر الطبيعي أو كلمة المرور غير صحيحة", "fail");
      
      // إضافة تأخير أمني بعد المحاولات الفاشلة
      if (securityStats.failCount >= 3) {
        setTimeout(() => {
          showResult("⚠️ تم تسجيل محاولات دخول مشبوهة. يرجى المحاولة لاحقاً", "fail");
        }, 2000);
      }
    }
  } catch (error) {
    console.error("Verification error:", error);
    showResult("حدث خطأ أثناء عملية التحقق الآمن", "fail");
  }
}

// دالة تعيين مفتاح جديد
async function setKey() {
  if (!selectedSettingsImage) {
    showResult("يرجى اختيار منظر طبيعي ليكون مفتاحك السري", "fail");
    return;
  }

  const password = document.getElementById("setKeyPassword").value;
  if (!password) {
    showResult("يرجى إدخال كلمة مرور قوية", "fail");
    return;
  }

  if (password.length < 8) {
    showResult("كلمة المرور يجب أن تكون 8 أحرف على الأقل للحماية القصوى", "fail");
    return;
  }

  // التحقق من قوة كلمة المرور
  const passwordStrength = checkPasswordStrength(password);
  if (passwordStrength < 3) {
    showResult("كلمة المرور ضعيفة. يرجى استخدام مزيج من الأحرف والأرقام والرموز", "warning");
    return;
  }

  const confirmChange = await showConfirmDialog("هل أنت متأكد من تعيين هذا المفتاح الآمن؟ لن تتمكن من الوصول للنظام بدون هذا المنظر الطبيعي وكلمة المرور.");
  if (!confirmChange) return;

  try {
    showResult("جاري حفظ المفتاح الآمن..." + '<div class="loading-spinner"></div>', "warning");
    
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    const hash = await calculateCombinedHash(selectedSettingsImage, password);
    if (!hash) return;

    localStorage.setItem("keynova_combined_hash_v2", hash);
    
    // تحديث إحصائيات الإنشاء
    if (!securityStats.creationDate) {
      securityStats.creationDate = new Date().toISOString();
    }
    saveSecurityStats();
    
    showResult("✅ تم حفظ المفتاح الآمن الجديد بنجاح", "success");
    
    // مسح الحقول
    document.getElementById("setKeyPassword").value = '';
    selectedSettingsImage = null;
    document.querySelectorAll('#settingsGallery .image-item').forEach(item => {
      item.classList.remove('selected');
    });
  } catch (error) {
    console.error("Error setting key:", error);
    showResult("حدث خطأ أثناء حفظ المفتاح الآمن", "fail");
  }
}

// التحقق من قوة كلمة المرور
function checkPasswordStrength(password) {
  let strength = 0;
  if (password.length >= 8) strength++;
  if (/[a-z]/.test(password)) strength++;
  if (/[A-Z]/.test(password)) strength++;
  if (/\d/.test(password)) strength++;
  if (/[^a-zA-Z\d]/.test(password)) strength++;
  return strength;
}

// إنشاء كلمة مرور آمنة
function generateSecurePassword() {
  const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';
  let password = '';
  
  for (let i = 0; i < 12; i++) {
    password += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  
  document.getElementById("setKeyPassword").value = password;
  showResult("تم إنشاء كلمة مرور آمنة. يرجى حفظها في مكان آمن", "success");
}

// إزالة المفتاح
async function removeKey() {
  if (!localStorage.getItem("keynova_combined_hash_v2")) {
    showResult("لا يوجد مفتاح آمان محفوظ", "fail");
    return;
  }

  const confirmDelete = await showConfirmDialog("⚠️ هل أنت متأكد من إزالة المفتاح الآمن نهائياً؟ ستفقد الوصول لجميع البيانات المحمية.");
  if (!confirmDelete) return;

  localStorage.removeItem("keynova_combined_hash_v2");
  localStorage.removeItem("protected_target");
  localStorage.removeItem("keynova_security_stats");
  
  // إعادة تعيين الإحصائيات
  securityStats = { successCount: 0, failCount: 0, lastAccess: null, creationDate: null };
  updateStatsDisplay();
  
  document.getElementById("securedActions").classList.add("hidden");
  document.getElementById("settings-content").classList.add("hidden");
  document.getElementById("no-key-section").classList.remove("hidden");
  showResult("✅ تمت إزالة المفتاح الآمن نهائياً", "success");
}

// دالة إنشاء modal تأكيد مخصص
function showConfirmDialog(message) {
  return new Promise((resolve) => {
    const modal = document.createElement('div');
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
    `;
    
    modal.innerHTML = `
      <div style="
        background: linear-gradient(135deg, var(--dark-light), var(--dark-lighter));
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        max-width: 450px;
        width: 90%;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
      ">
        <div style="
          width: 80px;
          height: 80px;
          background: linear-gradient(135deg, var(--warning), var(--accent-dark));
          border-radius: 50%;
          margin: 0 auto 25px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <i class="fas fa-exclamation-triangle" style="font-size: 36px; color: white;"></i>
        </div>
        <h3 style="color: var(--light); margin-bottom: 20px; font-size: 20px; font-weight: 700;">تأكيد العملية</h3>
        <p style="color: var(--gray); margin-bottom: 35px; font-size: 16px; line-height: 1.6;">${message}</p>
        <div style="display: flex; gap: 20px; justify-content: center;">
          <button id="cancelBtn" style="
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
          ">إلغاء</button>
          <button id="confirmBtn" style="
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
          ">تأكيد</button>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    const cancelBtn = modal.querySelector('#cancelBtn');
    const confirmBtn = modal.querySelector('#confirmBtn');
    
    cancelBtn.onmouseover = () => {
      cancelBtn.style.background = 'rgba(255, 255, 255, 0.2)';
    };
    
    cancelBtn.onmouseout = () => {
      cancelBtn.style.background = 'rgba(255, 255, 255, 0.1)';
    };
    
    confirmBtn.onmouseover = () => {
      confirmBtn.style.transform = 'translateY(-2px)';
      confirmBtn.style.boxShadow = '0 8px 25px rgba(37, 99, 235, 0.4)';
    };
    
    confirmBtn.onmouseout = () => {
      confirmBtn.style.transform = 'translateY(0)';
      confirmBtn.style.boxShadow = '0 4px 15px rgba(37, 99, 235, 0.3)';
    };
    
    cancelBtn.onclick = () => {
      document.body.removeChild(modal);
      resolve(false);
    };
    
    confirmBtn.onclick = () => {
      document.body.removeChild(modal);
      resolve(true);
    };
    
    modal.onclick = (e) => {
      if (e.target === modal) {
        document.body.removeChild(modal);
        resolve(false);
      }
    };
  });
}

// حماية الهدف المحدد
function protectSelected() {
  const target = document.getElementById("protectedTarget").value;
  
  if (!target) {
    showResult("يرجى اختيار نوع الحماية المطلوبة", "fail");
    return;
  }

  localStorage.setItem("protected_target", target);
  showResult(`✅ تم تفعيل الحماية المتقدمة على: ${getTargetName(target)}`, "success");
}

// إلغاء الحماية
function clearProtection() {
  if (!localStorage.getItem("protected_target")) {
    showResult("لا توجد حماية مفعلة حالياً", "fail");
    return;
  }

  localStorage.removeItem("protected_target");
  showResult("تم إلغاء الحماية بنجاح", "success");
}

// تبديل التبويبات
function openTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active-tab');
  });

  document.getElementById(tabName).classList.add('active-tab');

  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });

  event.currentTarget.classList.add('active');
}

// عرض النتائج
function showResult(message, type) {
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = message;
  resultDiv.className = "result " + type;
}

// بدء مؤقت الجلسة
function startSessionTimer() {
  sessionTimeLeft = 900; // 15 دقيقة
  const timerElement = document.getElementById("sessionTimer");
  const progressElement = document.getElementById("sessionProgress");

  if (sessionTimer) {
    clearInterval(sessionTimer);
  }

  sessionTimer = setInterval(() => {
    const minutes = Math.floor(sessionTimeLeft / 60);
    const seconds = sessionTimeLeft % 60;

    timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    
    // تحديث شريط التقدم
    const progressPercent = (sessionTimeLeft / 900) * 100;
    progressElement.style.width = progressPercent + '%';
    
    if (progressPercent < 25) {
      progressElement.style.background = 'linear-gradient(90deg, var(--danger), var(--warning))';
    } else if (progressPercent < 50) {
      progressElement.style.background = 'linear-gradient(90deg, var(--warning), var(--accent))';
    }

    if (sessionTimeLeft <= 0) {
      clearInterval(sessionTimer);
      lockSession();
    } else {
      sessionTimeLeft--;
    }
  }, 1000);
}

// قفل الجلسة
function lockSession() {
  if (sessionTimer) {
    clearInterval(sessionTimer);
  }
  
  document.getElementById("securedActions").classList.add("hidden");
  document.getElementById("settings-content").classList.add("hidden");
  document.getElementById("no-key-section").classList.remove("hidden");
  showResult("🔒 انتهت صلاحية الجلسة الآمنة، يرجى إعادة التحقق", "warning");
  
  // مسح التحديدات
  selectedVerifyImage = null;
  selectedSettingsImage = null;
  document.getElementById("verifyPassword").value = '';
  document.querySelectorAll('.image-item').forEach(item => {
    item.classList.remove('selected');
  });
}

// الحصول على اسم الهدف
function getTargetName(target) {
  const targets = {
    'images': 'الصور والذكريات',
    'docs': 'المستندات المهمة',
    'apps': 'التطبيقات الشخصية',
    'custom': 'مجلد مخصص',
    'system': 'إعدادات النظام'
  };
  return targets[target] || target;
}

// تهيئة الصفحة عند التحميل
window.onload = function() {
  // تحميل الإحصائيات
  loadSecurityStats();
  
  // إنشاء معارض المناظر الطبيعية
  createImageGallery('verifyGallery', false);
  createImageGallery('settingsGallery', true);
  
  // تحميل حالة الحماية إن وجدت
  const storedTarget = localStorage.getItem("protected_target");
  if (storedTarget) {
    document.getElementById("protectionStatus").innerHTML = `✅ الحماية مفعّلة على: ${getTargetName(storedTarget)}`;
    document.getElementById("protectionStatus").className = "result success";
  }

  // التحقق من وجود مفتاح
  const hasKey = localStorage.getItem("keynova_combined_hash_v2") !== null;

  if (hasKey) {
    document.getElementById("settings-content").classList.add("hidden");
    document.getElementById("no-key-section").classList.add("hidden");
  } else {
    document.getElementById("settings-content").classList.remove("hidden");
    document.getElementById("no-key-section").classList.remove("hidden");
  }
  
  // إضافة تأثيرات التحميل
  document.body.style.opacity = '0';
  setTimeout(() => {
    document.body.style.transition = 'opacity 0.5s ease';
    document.body.style.opacity = '1';
  }, 100);
};
</script>
</body>
</html>
